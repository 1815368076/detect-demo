/*! Detect Demo - v0.0.1 - 2012-11-13*/
(function(){"use strict";function i(i,s){function E(){v.fillStyle="#EEE",v.fillRect(0,0,m,g)}function S(e){var t=u.find(e),n=u.find(".url-field");n.width(t.outerWidth(!0)+n.width()),t.hide()}function x(){w.addClass("loading")}function T(){w.removeClass("loading invalid")}function C(e){N.text(e)}function k(e,t){x();if(t.length===0)C(r.NO_FACE);else for(var n=t.length-1;n>=0;n--){var i=t[n],s,o;i.attribute.gender.value==="Male"?(s="#12BDDC",o="rgba(18,189,220,0.8)"):(s="#C537D8",o="rgba(197,55,216,0.8)");var u=["eye_left","eye_right","mouth_left","mouth_right"];v.fillStyle=s;for(var a=u.length-1;a>=0;a--)v.beginPath(),v.arc(e.offsetX+i[u[a]].x*e.width*.01,e.offsetY+i[u[a]].y*e.height*.01,i.width*.01*6,0,Math.PI*2),v.fill();$("<div/>").css({position:"absolute",top:e.offsetY+(i.center.y-i.height/2)*.01*e.height-5,left:e.offsetX+(i.center.x-i.width/2)*.01*e.width-5,width:i.width*e.width*.01,height:i.height*e.height*.01,border:"5px solid "+s,borderColor:o,borderRadius:"10px"}).qtip({content:"<table><tr><td>width</td><td>"+(i.width*.01).toFixed(2)+"</td></tr>"+"<tr><td>height</td><td>"+(i.height*.01).toFixed(2)+"</td></tr>"+"<tr><td>center</td><td>("+(i.center.x*.01).toFixed(2)+", "+(i.center.y*.01).toFixed(2)+")</td></tr>"+"<tr><td>eye_left</td><td>("+(i.eye_left.x*.01).toFixed(2)+", "+(i.eye_left.y*.01).toFixed(2)+")</td></tr>"+"<tr><td>eye_right</td><td>("+(i.eye_right.x*.01).toFixed(2)+", "+(i.eye_right.y*.01).toFixed(2)+")</td></tr>"+"<tr><td>mouth_left</td><td>("+(i.mouth_left.x*.01).toFixed(2)+", "+(i.mouth_left.y*.01).toFixed(2)+")</td></tr>"+"<tr><td>mouth_right</td><td>("+(i.mouth_right.x*.01).toFixed(2)+", "+(i.mouth_right.y*.01).toFixed(2)+")</td></tr>"+"<tr><td>race</td><td>"+i.attribute.race.value+" ("+i.attribute.race.confidence.toFixed(2)+"%)</td></tr>"+"<tr><td>age</td><td>"+i.attribute.age.value+" (&#177;"+i.attribute.age.range+")</td></tr>"+"<tr><td>gender</td><td>"+i.attribute.gender.value+" ("+i.attribute.gender.confidence.toFixed(2)+"%)</td></tr>"+"</table>",style:{classes:"detector-tooltip ui-tooltip-light ui-tooltip-tipify"},position:{my:"bottom center",at:"top center"}}).appendTo(w)}T()}function L(i,s){if(i===y.src)return;var a=++b;x(),E(),w.children().remove(),y.onload=function(){var i=Math.min(m/y.width,g/y.height,1),f={width:y.width*i,height:y.height*i,offsetX:(m-y.width*i)/2,offsetY:(g-y.height*i)/2};v.drawImage(y,f.offsetX,f.offsetY,f.width,f.height),o({img:y.src,type:s?"dataURI":"url",success:function(r){if(a===b){var i=e+"detection/detect?api_key="+t+"&api_secret="+n;s||(i+="&url="+encodeURIComponent(y.src)),C(i);var o=JSON.stringify(r,null,"  ");try{Rainbow.color(o,"javascript",function(e){u.find(".result").html(e)})}catch(l){u.find(".result").text(o)}k(f,r.face)}},error:function(){a===b&&(E(),T(),C(r.LOAD_ERROR))}})},y.onerror=function(){E(),T(),w.addClass("invalid"),u.find(".result").html(""),C(r.URL_ERROR)},y.src=i}var u=$(i),a=u.find(".photolist"),f=[];for(var l=0,c=s.imgs.length;l<c;l++){var h=document.createElement("img");h.src=s.imgs[l],h.width=h.height=80,f.push(h)}a.append(f);var p=!1;u.find(".left-paddle").click(function(){p===!1&&(p=!0,a.css({left:"-80px"}).prepend(a.children("img:last-child")).animate({left:0},200,"linear",function(){p=!1}))}),u.find(".right-paddle").click(function(){p===!1&&(p=!0,a.animate({left:"-80px"},200,"linear",function(){a.css({left:0}).append(a.children("img:first-child")),p=!1}))});var d=u.find(".canvas").get(0),v=d.getContext("2d"),m=d.width,g=d.height,y=new Image,b=0,w=u.find(".faces"),N=u.find(".rest-url");u.find(".url-field").focus(function(){$(this).select()}).mouseup(function(){return!1}),u.find(".url-form").on("submit",function(){return L($(this).children(".url-field").val()),!1}),a.children("img").click(function(){var e=u.find(".url-field");e.val(this.src),L(this.src)});if(navigator.getUserMedia){var A=u.find(".webcam");A&&A.click(function(){return $(".camera-modal").show(),navigator.getUserMedia({video:!0,audio:!1},function(e){var t=$(".camera-modal video").get(0),n=u.find(".camera-modal"),r=function(){$(t).hide(),e.stop(),n.hide(),u.find(".capture").hide(),n.unbind("click")};n.click(r),t.src=window.URL.createObjectURL(e),t.onerror=function(){e.stop(),r()},$([u.find(".capture").get(0),t]).show().unbind("click").click(function(){x();var e=Math.min(m/t.videoWidth,g/t.videoHeight,1),n=document.createElement("canvas");return n.height=t.videoHeight*e,n.width=t.videoWidth*e,n.getContext("2d").drawImage(t,0,0,t.videoWidth*e,t.videoHeight*e),L(n.toDataURL("image/jpeg"),!0),r(),!1})},function(){$(".camera-modal").hide(),C(r.NO_CAMERA),S(".webcam")}),!1})}else S(".webcam");window.FileReader?u.find(".upload-file").change(function(){if(this.files.length>0){x();var e=new FileReader;e.onload=function(){L(e.result,!0)},e.onerror=function(){T(),w.addClass("invalid")},e.readAsDataURL(this.files[0])}}):S(".upload-file-wrapper"),E(),a.children("img:first-child").click()}function s(e){var t=atob(e.split(",")[1]),n=[];for(var r=0;r<t.length;r++)n.push(t.charCodeAt(r));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})}function o(r){if($.support.cors){var i=new XMLHttpRequest;i.timeout=1e4,i.onreadystatechange=function(){i.readyState===4&&(i.status===200?r.success(JSON.parse(i.responseText)):r.error())};if(r.type==="url")i.open("GET",e+"detection/detect?api_key="+t+"&api_secret="+n+"&url="+encodeURIComponent(r.img),!0),i.send();else if(r.type==="dataURI"){i.open("POST",e+"detection/detect?api_key="+t+"&api_secret="+n,!0);var o=new FormData;o.append("img",s(r.img)),i.send(o)}else r.error()}else r.type==="url"?$.ajax({url:e+"detection/detect",data:{api_key:t,api_secret:n,url:r.img},dataType:"jsonp",success:r.success,error:r.error,timeout:1e4}):r.error()}var e="http://api.faceplusplus.com/",t="2e7316b02a8ac15f07751511300520bf",n="nIVeO-lLAv_1WBgZWssrc0IiOLiSDl4A",r={URL_ERROR:"Invalid URL",LOAD_ERROR:"Failed to Load",LOADING:"Loading...",NO_FACE:"No face detected",NO_CAMERA:"No camera available"};window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,$(function(){i(document.getElementById("detector"),{imgs:["http://faceplusplus.com/static/img/demo/1.jpg","http://faceplusplus.com/static/img/demo/2.jpg","http://faceplusplus.com/static/img/demo/3.jpg","http://faceplusplus.com/static/img/demo/4.jpg","http://faceplusplus.com/static/img/demo/5.jpg","http://faceplusplus.com/static/img/demo/6.jpg","http://faceplusplus.com/static/img/demo/7.jpg","http://faceplusplus.com/static/img/demo/8.jpg","http://faceplusplus.com/static/img/demo/9.jpg","http://faceplusplus.com/static/img/demo/10.jpg","http://faceplusplus.com/static/img/demo/11.jpg","http://faceplusplus.com/static/img/demo/12.jpg","http://faceplusplus.com/static/img/demo/13.jpg","http://faceplusplus.com/static/img/demo/14.jpg","http://faceplusplus.com/static/img/demo/15.jpg","http://faceplusplus.com/static/img/demo/16.jpg","http://faceplusplus.com/static/img/demo/17.jpg","http://faceplusplus.com/static/img/demo/18.jpg","http://faceplusplus.com/static/img/demo/19.jpg","http://faceplusplus.com/static/img/demo/20.jpg","http://faceplusplus.com/static/img/demo/21.jpg"]})})})();